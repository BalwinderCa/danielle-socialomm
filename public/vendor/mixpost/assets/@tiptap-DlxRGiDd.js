import{r as te,d as Ct,p as Dt,e as ve,n as ke,u as Me,o as ee,h as Lt,s as we,f as Se,m as ne,a as Te,g as Rt,i as xe,j as Ae}from"./@vue-DxEuNGre.js";import{P as I,a as N,N as V,S as F,T as H,E as Ee}from"./prosemirror-state-Dfkm3xtq.js";import{d as Ce}from"./prosemirror-dropcursor-CRVdsyHs.js";import{g as Le}from"./prosemirror-gapcursor-CIClWOe5.js";import{u as Pe,r as Oe,h as $e}from"./prosemirror-history-C8_5KGmB.js";import{r as jt,f as se,t as Ie,a as He}from"./linkifyjs-CkylhtGF.js";import{E as Ne,D as re,a as oe}from"./prosemirror-view-CARpBv5D.js";import{k as Be}from"./prosemirror-keymap-BrtsOOc5.js";import{F as st,S as _e,a as ie,D as vt,b as De}from"./prosemirror-model-C-VrLeHJ.js";import{f as Re,c as Pt,T as je,l as Fe,j as ae,a as rt,R as ze,b as qe}from"./prosemirror-transform-CNTRfHZy.js";import{c as We,d as Ve,e as Ke,j as Ue,a as Qe,b as Ge,f as Je,g as Xe,h as Ye,l as Ze,i as tn,n as en,s as nn,k as sn,m as rn,o as on,p as an,q as Ft,w as ln}from"./prosemirror-commands-B8A7CEu7.js";import{l as cn,s as dn,w as un}from"./prosemirror-schema-list-B_jBki9Q.js";function lt(t){const{state:e,transaction:n}=t;let{selection:s}=n,{doc:r}=n,{storedMarks:o}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return o},get selection(){return s},get doc(){return r},get tr(){return s=n.selection,r=n.doc,o=n.storedMarks,n}}}class ct{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:s}=this,{view:r}=n,{tr:o}=s,i=this.buildProps(o);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const d=l(...u)(i);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(o),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:s,editor:r,state:o}=this,{view:i}=r,a=[],l=!!e,c=e||o.tr,u=()=>(!l&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(c),a.every(f=>f===!0)),d={...Object.fromEntries(Object.entries(s).map(([f,p])=>[f,(...y)=>{const g=this.buildProps(c,n),m=p(...y)(g);return a.push(m),d}])),run:u};return d}createCan(e){const{rawCommands:n,state:s}=this,r=!1,o=e||s.tr,i=this.buildProps(o,r);return{...Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)({...i,dispatch:void 0})])),chain:()=>this.createChain(o,r)}}buildProps(e,n=!0){const{rawCommands:s,editor:r,state:o}=this,{view:i}=r,a={tr:e,editor:r,view:i,state:lt({state:o,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(s).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}}class pn{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const s=this.callbacks[e];return s&&s.forEach(r=>r.apply(this,n)),this}off(e,n){const s=this.callbacks[e];return s&&(n?this.callbacks[e]=s.filter(r=>r!==n):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}function v(t,e,n){return t.config[e]===void 0&&t.parent?v(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?v(t.parent,e,n):null}):t.config[e]}function dt(t){const e=t.filter(r=>r.type==="extension"),n=t.filter(r=>r.type==="node"),s=t.filter(r=>r.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:s}}function le(t){const e=[],{nodeExtensions:n,markExtensions:s}=dt(t),r=[...n,...s],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage,extensions:r},l=v(i,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([f,p])=>{e.push({type:d,name:f,attribute:{...o,...p}})})})})}),r.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage},l=v(i,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const f={...o,...d};typeof(f==null?void 0:f.default)=="function"&&(f.default=f.default()),f!=null&&f.isRequired&&(f==null?void 0:f.default)===void 0&&delete f.default,e.push({type:i.name,name:u,attribute:f})})}),e}function C(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function S(...t){return t.filter(e=>!!e).reduce((e,n)=>{const s={...e};return Object.entries(n).forEach(([r,o])=>{if(!s[r]){s[r]=o;return}if(r==="class"){const a=o?o.split(" "):[],l=s[r]?s[r].split(" "):[],c=a.filter(u=>!l.includes(u));s[r]=[...l,...c].join(" ")}else if(r==="style"){const a=o?o.split(";").map(u=>u.trim()).filter(Boolean):[],l=s[r]?s[r].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,f]=u.split(":").map(p=>p.trim());c.set(d,f)}),a.forEach(u=>{const[d,f]=u.split(":").map(p=>p.trim());c.set(d,f)}),s[r]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else s[r]=o}),s},{})}function St(t,e){return e.filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,s)=>S(n,s),{})}function ce(t){return typeof t=="function"}function k(t,e=void 0,...n){return ce(t)?e?t.bind(e)(...n):t(...n):t}function fn(t={}){return Object.keys(t).length===0&&t.constructor===Object}function hn(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function zt(t,e){return"style"in t?t:{...t,getAttrs:n=>{const s=t.getAttrs?t.getAttrs(n):t.attrs;if(s===!1)return!1;const r=e.reduce((o,i)=>{const a=i.attribute.parseHTML?i.attribute.parseHTML(n):hn(n.getAttribute(i.name));return a==null?o:{...o,[i.name]:a}},{});return{...s,...r}}}}function qt(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&fn(n)?!1:n!=null))}function mn(t,e){var n;const s=le(t),{nodeExtensions:r,markExtensions:o}=dt(t),i=(n=r.find(c=>v(c,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(r.map(c=>{const u=s.filter(m=>m.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((m,b)=>{const M=v(b,"extendNodeSchema",d);return{...m,...M?M(c):{}}},{}),p=qt({...f,content:k(v(c,"content",d)),marks:k(v(c,"marks",d)),group:k(v(c,"group",d)),inline:k(v(c,"inline",d)),atom:k(v(c,"atom",d)),selectable:k(v(c,"selectable",d)),draggable:k(v(c,"draggable",d)),code:k(v(c,"code",d)),whitespace:k(v(c,"whitespace",d)),defining:k(v(c,"defining",d)),isolating:k(v(c,"isolating",d)),attrs:Object.fromEntries(u.map(m=>{var b;return[m.name,{default:(b=m==null?void 0:m.attribute)===null||b===void 0?void 0:b.default}]}))}),h=k(v(c,"parseHTML",d));h&&(p.parseDOM=h.map(m=>zt(m,u)));const y=v(c,"renderHTML",d);y&&(p.toDOM=m=>y({node:m,HTMLAttributes:St(m,u)}));const g=v(c,"renderText",d);return g&&(p.toText=g),[c.name,p]})),l=Object.fromEntries(o.map(c=>{const u=s.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((g,m)=>{const b=v(m,"extendMarkSchema",d);return{...g,...b?b(c):{}}},{}),p=qt({...f,inclusive:k(v(c,"inclusive",d)),excludes:k(v(c,"excludes",d)),group:k(v(c,"group",d)),spanning:k(v(c,"spanning",d)),code:k(v(c,"code",d)),attrs:Object.fromEntries(u.map(g=>{var m;return[g.name,{default:(m=g==null?void 0:g.attribute)===null||m===void 0?void 0:m.default}]}))}),h=k(v(c,"parseHTML",d));h&&(p.parseDOM=h.map(g=>zt(g,u)));const y=v(c,"renderHTML",d);return y&&(p.toDOM=g=>y({mark:g,HTMLAttributes:St(g,u)})),[c.name,p]}));return new ie({topNode:i,nodes:a,marks:l})}function kt(t,e){return e.nodes[t]||e.marks[t]||null}function Wt(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}const gn=(t,e=500)=>{let n="";const s=t.parentOffset;return t.parent.nodesBetween(Math.max(0,s-e),s,(r,o,i,a)=>{var l,c;const u=((c=(l=r.type.spec).toText)===null||c===void 0?void 0:c.call(l,{node:r,pos:o,parent:i,index:a}))||r.textContent||"%leaf%";n+=r.isAtom&&!r.isText?u:u.slice(0,Math.max(0,s-o))}),n};function Ot(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class Y{constructor(e){this.find=e.find,this.handler=e.handler}}const yn=(t,e)=>{if(Ot(e))return e.exec(t);const n=e(t);if(!n)return null;const s=[n.text];return s.index=n.index,s.input=t,s.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(n.replaceWith)),s};function tt(t){var e;const{editor:n,from:s,to:r,text:o,rules:i,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(s);if(c.parent.type.spec.code||!((e=c.nodeBefore||c.nodeAfter)===null||e===void 0)&&e.marks.find(f=>f.type.spec.code))return!1;let u=!1;const d=gn(c)+o;return i.forEach(f=>{if(u)return;const p=yn(d,f.find);if(!p)return;const h=l.state.tr,y=lt({state:l.state,transaction:h}),g={from:s-(p[0].length-o.length),to:r},{commands:m,chain:b,can:M}=new ct({editor:n,state:y});f.handler({state:y,range:g,match:p,commands:m,chain:b,can:M})===null||!h.steps.length||(h.setMeta(a,{transform:h,from:s,to:r,text:o}),l.dispatch(h),u=!0)}),u}function bn(t){const{editor:e,rules:n}=t,s=new I({state:{init(){return null},apply(r,o){const i=r.getMeta(s);if(i)return i;const a=r.getMeta("applyInputRules");return!!a&&setTimeout(()=>{const{from:c,text:u}=a,d=c+u.length;tt({editor:e,from:c,to:d,text:u,rules:n,plugin:s})}),r.selectionSet||r.docChanged?null:o}},props:{handleTextInput(r,o,i,a){return tt({editor:e,from:o,to:i,text:a,rules:n,plugin:s})},handleDOMEvents:{compositionend:r=>(setTimeout(()=>{const{$cursor:o}=r.state.selection;o&&tt({editor:e,from:o.pos,to:o.pos,text:"",rules:n,plugin:s})}),!1)},handleKeyDown(r,o){if(o.key!=="Enter")return!1;const{$cursor:i}=r.state.selection;return i?tt({editor:e,from:i.pos,to:i.pos,text:`
`,rules:n,plugin:s}):!1}},isInputRules:!0});return s}function vn(t){return typeof t=="number"}class kn{constructor(e){this.find=e.find,this.handler=e.handler}}const Mn=(t,e,n)=>{if(Ot(e))return[...t.matchAll(e)];const s=e(t,n);return s?s.map(r=>{const o=[r.text];return o.index=r.index,o.input=t,o.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(r.replaceWith)),o}):[]};function wn(t){const{editor:e,state:n,from:s,to:r,rule:o,pasteEvent:i,dropEvent:a}=t,{commands:l,chain:c,can:u}=new ct({editor:e,state:n}),d=[];return n.doc.nodesBetween(s,r,(p,h)=>{if(!p.isTextblock||p.type.spec.code)return;const y=Math.max(s,h),g=Math.min(r,h+p.content.size),m=p.textBetween(y-h,g-h,void 0,"￼");Mn(m,o.find,i).forEach(M=>{if(M.index===void 0)return;const w=y+M.index+1,x=w+M[0].length,E={from:n.tr.mapping.map(w),to:n.tr.mapping.map(x)},O=o.handler({state:n,range:E,match:M,commands:l,chain:c,can:u,pasteEvent:i,dropEvent:a});d.push(O)})}),d.every(p=>p!==null)}const Sn=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function Tn(t){const{editor:e,rules:n}=t;let s=null,r=!1,o=!1,i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a=typeof DragEvent<"u"?new DragEvent("drop"):null;const l=({state:u,from:d,to:f,rule:p,pasteEvt:h})=>{const y=u.tr,g=lt({state:u,transaction:y});if(!(!wn({editor:e,state:g,from:Math.max(d-1,0),to:f.b-1,rule:p,pasteEvent:h,dropEvent:a})||!y.steps.length))return a=typeof DragEvent<"u"?new DragEvent("drop"):null,i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,y};return n.map(u=>new I({view(d){const f=p=>{var h;s=!((h=d.dom.parentElement)===null||h===void 0)&&h.contains(p.target)?d.dom.parentElement:null};return window.addEventListener("dragstart",f),{destroy(){window.removeEventListener("dragstart",f)}}},props:{handleDOMEvents:{drop:(d,f)=>(o=s===d.dom.parentElement,a=f,!1),paste:(d,f)=>{var p;const h=(p=f.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return i=f,r=!!(h!=null&&h.includes("data-pm-slice")),!1}}},appendTransaction:(d,f,p)=>{const h=d[0],y=h.getMeta("uiEvent")==="paste"&&!r,g=h.getMeta("uiEvent")==="drop"&&!o,m=h.getMeta("applyPasteRules"),b=!!m;if(!y&&!g&&!b)return;if(b){const{from:x,text:E}=m,O=x+E.length,P=Sn(E);return l({rule:u,state:p,from:x,to:{b:O},pasteEvt:P})}const M=f.doc.content.findDiffStart(p.doc.content),w=f.doc.content.findDiffEnd(p.doc.content);if(!(!vn(M)||!w||M===w.b))return l({rule:u,state:p,from:M,to:w,pasteEvt:i})}}))}function xn(t){const e=t.filter((n,s)=>t.indexOf(n)!==s);return Array.from(new Set(e))}class W{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=W.resolve(e),this.schema=mn(this.extensions,n),this.setupExtensions()}static resolve(e){const n=W.sort(W.flatten(e)),s=xn(n.map(r=>r.name));return s.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${s.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const s={name:n.name,options:n.options,storage:n.storage},r=v(n,"addExtensions",s);return r?[n,...this.flatten(r())]:n}).flat(10)}static sort(e){return e.sort((s,r)=>{const o=v(s,"priority")||100,i=v(r,"priority")||100;return o>i?-1:o<i?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const s={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:kt(n.name,this.schema)},r=v(n,"addCommands",s);return r?{...e,...r()}:e},{})}get plugins(){const{editor:e}=this,n=W.sort([...this.extensions].reverse()),s=[],r=[],o=n.map(i=>{const a={name:i.name,options:i.options,storage:i.storage,editor:e,type:kt(i.name,this.schema)},l=[],c=v(i,"addKeyboardShortcuts",a);let u={};if(i.type==="mark"&&v(i,"exitable",a)&&(u.ArrowRight=()=>_.handleExit({editor:e,mark:i})),c){const y=Object.fromEntries(Object.entries(c()).map(([g,m])=>[g,()=>m({editor:e})]));u={...u,...y}}const d=Be(u);l.push(d);const f=v(i,"addInputRules",a);Wt(i,e.options.enableInputRules)&&f&&s.push(...f());const p=v(i,"addPasteRules",a);Wt(i,e.options.enablePasteRules)&&p&&r.push(...p());const h=v(i,"addProseMirrorPlugins",a);if(h){const y=h();l.push(...y)}return l}).flat();return[bn({editor:e,rules:s}),...Tn({editor:e,rules:r}),...o]}get attributes(){return le(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=dt(this.extensions);return Object.fromEntries(n.filter(s=>!!v(s,"addNodeView")).map(s=>{const r=this.attributes.filter(l=>l.type===s.name),o={name:s.name,options:s.options,storage:s.storage,editor:e,type:C(s.name,this.schema)},i=v(s,"addNodeView",o);if(!i)return[];const a=(l,c,u,d,f)=>{const p=St(l,r);return i()({node:l,view:c,getPos:u,decorations:d,innerDecorations:f,editor:e,extension:s,HTMLAttributes:p})};return[s.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const s={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:kt(e.name,this.schema)};e.type==="mark"&&(!((n=k(v(e,"keepOnSplit",s)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const r=v(e,"onBeforeCreate",s),o=v(e,"onCreate",s),i=v(e,"onUpdate",s),a=v(e,"onSelectionUpdate",s),l=v(e,"onTransaction",s),c=v(e,"onFocus",s),u=v(e,"onBlur",s),d=v(e,"onDestroy",s);r&&this.editor.on("beforeCreate",r),o&&this.editor.on("create",o),i&&this.editor.on("update",i),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}}function An(t){return Object.prototype.toString.call(t).slice(8,-1)}function et(t){return An(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function ut(t,e){const n={...t};return et(t)&&et(e)&&Object.keys(e).forEach(s=>{et(e[s])&&et(t[s])?n[s]=ut(t[s],e[s]):n[s]=e[s]}),n}class ${constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=k(v(this,"addOptions",{name:this.name}))),this.storage=k(v(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new $(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>ut(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new $({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=k(v(n,"addOptions",{name:n.name})),n.storage=k(v(n,"addStorage",{name:n.name,options:n.options})),n}}function de(t,e,n){const{from:s,to:r}=e,{blockSeparator:o=`

`,textSerializers:i={}}=n||{};let a="";return t.nodesBetween(s,r,(l,c,u,d)=>{var f;l.isBlock&&c>s&&(a+=o);const p=i==null?void 0:i[l.type.name];if(p)return u&&(a+=p({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(f=l==null?void 0:l.text)===null||f===void 0?void 0:f.slice(Math.max(s,c)-c,r-c))}),a}function ue(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const En=$.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new I({key:new N("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:s,selection:r}=e,{ranges:o}=r,i=Math.min(...o.map(u=>u.$from.pos)),a=Math.max(...o.map(u=>u.$to.pos)),l=ue(n);return de(s,{from:i,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),Cn=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),Ln=(t=!1)=>({commands:e})=>e.setContent("",t),Pn=()=>({state:t,tr:e,dispatch:n})=>{const{selection:s}=e,{ranges:r}=s;return n&&r.forEach(({$from:o,$to:i})=>{t.doc.nodesBetween(o.pos,i.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),f=c.resolve(u.map(l+a.nodeSize)),p=d.blockRange(f);if(!p)return;const h=Fe(p);if(a.type.isTextblock){const{defaultType:y}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(p.start,y)}(h||h===0)&&e.lift(p,h)})}),!0},On=t=>e=>t(e),$n=()=>({state:t,dispatch:e})=>We(t,e),In=(t,e)=>({editor:n,tr:s})=>{const{state:r}=n,o=r.doc.slice(t.from,t.to);s.deleteRange(t.from,t.to);const i=s.mapping.map(e);return s.insert(i,o.content),s.setSelection(new H(s.doc.resolve(i-1))),!0},Hn=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,s=n.$anchor.node();if(s.content.size>0)return!1;const r=t.selection.$anchor;for(let o=r.depth;o>0;o-=1)if(r.node(o).type===s.type){if(e){const a=r.before(o),l=r.after(o);t.delete(a,l).scrollIntoView()}return!0}return!1},Nn=t=>({tr:e,state:n,dispatch:s})=>{const r=C(t,n.schema),o=e.selection.$anchor;for(let i=o.depth;i>0;i-=1)if(o.node(i).type===r){if(s){const l=o.before(i),c=o.after(i);e.delete(l,c).scrollIntoView()}return!0}return!1},Bn=t=>({tr:e,dispatch:n})=>{const{from:s,to:r}=t;return n&&e.delete(s,r),!0},_n=()=>({state:t,dispatch:e})=>Ve(t,e),Dn=()=>({commands:t})=>t.keyboardShortcut("Enter"),Rn=()=>({state:t,dispatch:e})=>Ke(t,e);function it(t,e,n={strict:!0}){const s=Object.keys(e);return s.length?s.every(r=>n.strict?e[r]===t[r]:Ot(e[r])?e[r].test(t[r]):e[r]===t[r]):!0}function Tt(t,e,n={}){return t.find(s=>s.type===e&&it(s.attrs,n))}function jn(t,e,n={}){return!!Tt(t,e,n)}function $t(t,e,n={}){if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if(t.parentOffset===s.offset&&s.offset!==0&&(s=t.parent.childBefore(t.parentOffset)),!s.node)return;const r=Tt([...s.node.marks],e,n);if(!r)return;let o=s.index,i=t.start()+s.offset,a=o+1,l=i+s.node.nodeSize;for(Tt([...s.node.marks],e,n);o>0&&r.isInSet(t.parent.child(o-1).marks);)o-=1,i-=t.parent.child(o).nodeSize;for(;a<t.parent.childCount&&jn([...t.parent.child(a).marks],e,n);)l+=t.parent.child(a).nodeSize,a+=1;return{from:i,to:l}}function D(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const Fn=(t,e={})=>({tr:n,state:s,dispatch:r})=>{const o=D(t,s.schema),{doc:i,selection:a}=n,{$from:l,from:c,to:u}=a;if(r){const d=$t(l,o,e);if(d&&d.from<=c&&d.to>=u){const f=H.create(i,d.from,d.to);n.setSelection(f)}}return!0},zn=t=>e=>{const n=typeof t=="function"?t(e):t;for(let s=0;s<n.length;s+=1)if(n[s](e))return!0;return!1};function pe(t){return t instanceof H}function j(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function fe(t,e=null){if(!e)return null;const n=F.atStart(t),s=F.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return s;const r=n.from,o=s.to;return e==="all"?H.create(t,j(0,r,o),j(t.content.size,r,o)):H.create(t,j(e,r,o),j(e,r,o))}function pt(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const qn=(t=null,e={})=>({editor:n,view:s,tr:r,dispatch:o})=>{e={scrollIntoView:!0,...e};const i=()=>{pt()&&s.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(s.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(s.hasFocus()&&t===null||t===!1)return!0;if(o&&t===null&&!pe(n.state.selection))return i(),!0;const a=fe(r.doc,t)||n.state.selection,l=n.state.selection.eq(a);return o&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),i()),!0},Wn=(t,e)=>n=>t.every((s,r)=>e(s,{...n,index:r})),Vn=(t,e)=>({tr:n,commands:s})=>s.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),he=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const s=e[n];s.nodeType===3&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?t.removeChild(s):s.nodeType===1&&he(s)}return t};function nt(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return he(n)}function at(t,e,n){n={slice:!0,parseOptions:{},...n};const s=typeof t=="object"&&t!==null,r=typeof t=="string";if(s)try{if(Array.isArray(t)&&t.length>0)return st.fromArray(t.map(a=>e.nodeFromJSON(a)));const i=e.nodeFromJSON(t);return n.errorOnInvalidContent&&i.check(),i}catch(o){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",o),at("",e,n)}if(r){if(n.errorOnInvalidContent){let i=!1,a="";const l=new ie({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(i=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?vt.fromSchema(l).parseSlice(nt(t),n.parseOptions):vt.fromSchema(l).parse(nt(t),n.parseOptions),n.errorOnInvalidContent&&i)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const o=vt.fromSchema(e);return n.slice?o.parseSlice(nt(t),n.parseOptions).content:o.parse(nt(t),n.parseOptions)}return at("",e,n)}function Kn(t,e,n){const s=t.steps.length-1;if(s<e)return;const r=t.steps[s];if(!(r instanceof ze||r instanceof qe))return;const o=t.mapping.maps[s];let i=0;o.forEach((a,l,c,u)=>{i===0&&(i=u)}),t.setSelection(F.near(t.doc.resolve(i),n))}const Un=t=>!("type"in t),Qn=(t,e,n)=>({tr:s,dispatch:r,editor:o})=>{var i;if(r){n={parseOptions:{},updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;try{a=at(e,o.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions},errorOnInvalidContent:(i=n.errorOnInvalidContent)!==null&&i!==void 0?i:o.options.enableContentCheck})}catch(h){return o.emit("contentError",{editor:o,error:h,disableCollaboration:()=>{console.error("[tiptap error]: Unable to disable collaboration at this point in time")}}),!1}let{from:l,to:c}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},u=!0,d=!0;if((Un(a)?a:[a]).forEach(h=>{h.check(),u=u?h.isText&&h.marks.length===0:!1,d=d?h.isBlock:!1}),l===c&&d){const{parent:h}=s.doc.resolve(l);h.isTextblock&&!h.type.spec.code&&!h.childCount&&(l-=1,c+=1)}let p;u?(Array.isArray(e)?p=e.map(h=>h.text||"").join(""):typeof e=="object"&&e&&e.text?p=e.text:p=e,s.insertText(p,l,c)):(p=a,s.replaceWith(l,c,p)),n.updateSelection&&Kn(s,s.steps.length-1,-1),n.applyInputRules&&s.setMeta("applyInputRules",{from:l,text:p}),n.applyPasteRules&&s.setMeta("applyPasteRules",{from:l,text:p})}return!0},Gn=()=>({state:t,dispatch:e})=>Ue(t,e),Jn=()=>({state:t,dispatch:e})=>Qe(t,e),Xn=()=>({state:t,dispatch:e})=>Ge(t,e),Yn=()=>({state:t,dispatch:e})=>Je(t,e),Zn=()=>({state:t,dispatch:e,tr:n})=>{try{const s=ae(t.doc,t.selection.$from.pos,-1);return s==null?!1:(n.join(s,2),e&&e(n),!0)}catch{return!1}},ts=()=>({state:t,dispatch:e,tr:n})=>{try{const s=ae(t.doc,t.selection.$from.pos,1);return s==null?!1:(n.join(s,2),e&&e(n),!0)}catch{return!1}},es=()=>({state:t,dispatch:e})=>Xe(t,e),ns=()=>({state:t,dispatch:e})=>Ye(t,e);function me(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function ss(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let s,r,o,i;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))i=!0;else if(/^a(lt)?$/i.test(l))s=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))pt()||me()?i=!0:r=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return s&&(n=`Alt-${n}`),r&&(n=`Ctrl-${n}`),i&&(n=`Meta-${n}`),o&&(n=`Shift-${n}`),n}const rs=t=>({editor:e,view:n,tr:s,dispatch:r})=>{const o=ss(t).split(/-(?!$)/),i=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const u=c.map(s.mapping);u&&r&&s.maybeStep(u)}),!0};function J(t,e,n={}){const{from:s,to:r,empty:o}=t.selection,i=e?C(e,t.schema):null,a=[];t.doc.nodesBetween(s,r,(d,f)=>{if(d.isText)return;const p=Math.max(s,f),h=Math.min(r,f+d.nodeSize);a.push({node:d,from:p,to:h})});const l=r-s,c=a.filter(d=>i?i.name===d.node.type.name:!0).filter(d=>it(d.node.attrs,n,{strict:!1}));return o?!!c.length:c.reduce((d,f)=>d+f.to-f.from,0)>=l}const os=(t,e={})=>({state:n,dispatch:s})=>{const r=C(t,n.schema);return J(n,r,e)?Ze(n,s):!1},is=()=>({state:t,dispatch:e})=>tn(t,e),as=t=>({state:e,dispatch:n})=>{const s=C(t,e.schema);return cn(s)(e,n)},ls=()=>({state:t,dispatch:e})=>en(t,e);function ft(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function Vt(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((s,r)=>(n.includes(r)||(s[r]=t[r]),s),{})}const cs=(t,e)=>({tr:n,state:s,dispatch:r})=>{let o=null,i=null;const a=ft(typeof t=="string"?t:t.name,s.schema);return a?(a==="node"&&(o=C(t,s.schema)),a==="mark"&&(i=D(t,s.schema)),r&&n.selection.ranges.forEach(l=>{s.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{o&&o===c.type&&n.setNodeMarkup(u,void 0,Vt(c.attrs,e)),i&&c.marks.length&&c.marks.forEach(d=>{i===d.type&&n.addMark(u,u+c.nodeSize,i.create(Vt(d.attrs,e)))})})}),!0):!1},ds=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),us=()=>({tr:t,commands:e})=>e.setTextSelection({from:0,to:t.doc.content.size}),ps=()=>({state:t,dispatch:e})=>nn(t,e),fs=()=>({state:t,dispatch:e})=>sn(t,e),hs=()=>({state:t,dispatch:e})=>rn(t,e),ms=()=>({state:t,dispatch:e})=>on(t,e),gs=()=>({state:t,dispatch:e})=>an(t,e);function xt(t,e,n={},s={}){return at(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:s.errorOnInvalidContent})}const ys=(t,e=!1,n={},s={})=>({editor:r,tr:o,dispatch:i,commands:a})=>{var l,c;const{doc:u}=o;if(n.preserveWhitespace!=="full"){const d=xt(t,r.schema,n,{errorOnInvalidContent:(l=s.errorOnInvalidContent)!==null&&l!==void 0?l:r.options.enableContentCheck});return i&&o.replaceWith(0,u.content.size,d).setMeta("preventUpdate",!e),!0}return i&&o.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:u.content.size},t,{parseOptions:n,errorOnInvalidContent:(c=s.errorOnInvalidContent)!==null&&c!==void 0?c:r.options.enableContentCheck})};function ht(t,e){const n=D(e,t.schema),{from:s,to:r,empty:o}=t.selection,i=[];o?(t.storedMarks&&i.push(...t.storedMarks),i.push(...t.selection.$head.marks())):t.doc.nodesBetween(s,r,l=>{i.push(...l.marks)});const a=i.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function bs(t,e){const n=new je(t);return e.forEach(s=>{s.steps.forEach(r=>{n.step(r)})}),n}function vs(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function ks(t,e,n){const s=[];return t.nodesBetween(e.from,e.to,(r,o)=>{n(r)&&s.push({node:r,pos:o})}),s}function Ms(t,e){for(let n=t.depth;n>0;n-=1){const s=t.node(n);if(e(s))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:s}}}function It(t){return e=>Ms(e.$from,t)}function ws(t,e){const n=De.fromSchema(e).serializeFragment(t),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(n),r.innerHTML}function Ss(t,e){const n={from:0,to:t.content.size};return de(t,n,e)}function Ts(t,e){const n=C(e,t.schema),{from:s,to:r}=t.selection,o=[];t.doc.nodesBetween(s,r,a=>{o.push(a)});const i=o.reverse().find(a=>a.type.name===n.name);return i?{...i.attrs}:{}}function ge(t,e){const n=ft(typeof e=="string"?e:e.name,t.schema);return n==="node"?Ts(t,e):n==="mark"?ht(t,e):{}}function xs(t,e=JSON.stringify){const n={};return t.filter(s=>{const r=e(s);return Object.prototype.hasOwnProperty.call(n,r)?!1:n[r]=!0})}function As(t){const e=xs(t);return e.length===1?e:e.filter((n,s)=>!e.filter((o,i)=>i!==s).some(o=>n.oldRange.from>=o.oldRange.from&&n.oldRange.to<=o.oldRange.to&&n.newRange.from>=o.newRange.from&&n.newRange.to<=o.newRange.to))}function Es(t){const{mapping:e,steps:n}=t,s=[];return e.maps.forEach((r,o)=>{const i=[];if(r.ranges.length)r.forEach((a,l)=>{i.push({from:a,to:l})});else{const{from:a,to:l}=n[o];if(a===void 0||l===void 0)return;i.push({from:a,to:l})}i.forEach(({from:a,to:l})=>{const c=e.slice(o).map(a,-1),u=e.slice(o).map(l),d=e.invert().map(c,-1),f=e.invert().map(u);s.push({oldRange:{from:d,to:f},newRange:{from:c,to:u}})})}),As(s)}function Ht(t,e,n){const s=[];return t===e?n.resolve(t).marks().forEach(r=>{const o=n.resolve(t),i=$t(o,r.type);i&&s.push({mark:r,...i})}):n.nodesBetween(t,e,(r,o)=>{!r||(r==null?void 0:r.nodeSize)===void 0||s.push(...r.marks.map(i=>({from:o,to:o+r.nodeSize,mark:i})))}),s}function ot(t,e,n){return Object.fromEntries(Object.entries(n).filter(([s])=>{const r=t.find(o=>o.type===e&&o.name===s);return r?r.attribute.keepOnSplit:!1}))}function At(t,e,n={}){const{empty:s,ranges:r}=t.selection,o=e?D(e,t.schema):null;if(s)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>o?o.name===d.type.name:!0).find(d=>it(d.attrs,n,{strict:!1}));let i=0;const a=[];if(r.forEach(({$from:d,$to:f})=>{const p=d.pos,h=f.pos;t.doc.nodesBetween(p,h,(y,g)=>{if(!y.isText&&!y.marks.length)return;const m=Math.max(p,g),b=Math.min(h,g+y.nodeSize),M=b-m;i+=M,a.push(...y.marks.map(w=>({mark:w,from:m,to:b})))})}),i===0)return!1;const l=a.filter(d=>o?o.name===d.mark.type.name:!0).filter(d=>it(d.mark.attrs,n,{strict:!1})).reduce((d,f)=>d+f.to-f.from,0),c=a.filter(d=>o?d.mark.type!==o&&d.mark.type.excludes(o):!0).reduce((d,f)=>d+f.to-f.from,0);return(l>0?l+c:l)>=i}function Cs(t,e,n={}){if(!e)return J(t,null,n)||At(t,null,n);const s=ft(e,t.schema);return s==="node"?J(t,e,n):s==="mark"?At(t,e,n):!1}function Kt(t,e){const{nodeExtensions:n}=dt(e),s=n.find(i=>i.name===t);if(!s)return!1;const r={name:s.name,options:s.options,storage:s.storage},o=k(v(s,"group",r));return typeof o!="string"?!1:o.split(" ").includes("list")}function mt(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var s;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((s=t.text)!==null&&s!==void 0?s:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let r=!0;return t.content.forEach(o=>{r!==!1&&(mt(o,{ignoreWhitespace:n,checkChildren:e})||(r=!1))}),r}return!1}function Ls(t){return t instanceof V}function Ps(t,e,n){var s;const{selection:r}=e;let o=null;if(pe(r)&&(o=r.$cursor),o){const a=(s=t.storedMarks)!==null&&s!==void 0?s:o.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:i}=r;return i.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,d,f)=>{if(c)return!1;if(u.isInline){const p=!f||f.type.allowsMarkType(n),h=!!n.isInSet(u.marks)||!u.marks.some(y=>y.type.excludes(n));c=p&&h}return!c}),c})}const Os=(t,e={})=>({tr:n,state:s,dispatch:r})=>{const{selection:o}=n,{empty:i,ranges:a}=o,l=D(t,s.schema);if(r)if(i){const c=ht(s,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;s.doc.nodesBetween(u,d,(f,p)=>{const h=Math.max(p,u),y=Math.min(p+f.nodeSize,d);f.marks.find(m=>m.type===l)?f.marks.forEach(m=>{l===m.type&&n.addMark(h,y,l.create({...m.attrs,...e}))}):n.addMark(h,y,l.create(e))})});return Ps(s,n,l)},$s=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),Is=(t,e={})=>({state:n,dispatch:s,chain:r})=>{const o=C(t,n.schema);return o.isTextblock?r().command(({commands:i})=>Ft(o,e)(n)?!0:i.clearNodes()).command(({state:i})=>Ft(o,e)(i,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Hs=t=>({tr:e,dispatch:n})=>{if(n){const{doc:s}=e,r=j(t,0,s.content.size),o=V.create(s,r);e.setSelection(o)}return!0},Ns=t=>({tr:e,dispatch:n})=>{if(n){const{doc:s}=e,{from:r,to:o}=typeof t=="number"?{from:t,to:t}:t,i=H.atStart(s).from,a=H.atEnd(s).to,l=j(r,i,a),c=j(o,i,a),u=H.create(s,l,c);e.setSelection(u)}return!0},Bs=t=>({state:e,dispatch:n})=>{const s=C(t,e.schema);return dn(s)(e,n)};function Ut(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const s=n.filter(r=>e==null?void 0:e.includes(r.type.name));t.tr.ensureMarks(s)}}const _s=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:s,editor:r})=>{const{selection:o,doc:i}=e,{$from:a,$to:l}=o,c=r.extensionManager.attributes,u=ot(c,a.node().type.name,a.node().attrs);if(o instanceof V&&o.node.isBlock)return!a.parentOffset||!rt(i,a.pos)?!1:(s&&(t&&Ut(n,r.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,f=a.depth===0?void 0:vs(a.node(-1).contentMatchAt(a.indexAfter(-1)));let p=d&&f?[{type:f,attrs:u}]:void 0,h=rt(e.doc,e.mapping.map(a.pos),1,p);if(!p&&!h&&rt(e.doc,e.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(h=!0,p=f?[{type:f,attrs:u}]:void 0),s){if(h&&(o instanceof H&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,p),f&&!d&&!a.parentOffset&&a.parent.type!==f)){const y=e.mapping.map(a.before()),g=e.doc.resolve(y);a.node(-1).canReplaceWith(g.index(),g.index()+1,f)&&e.setNodeMarkup(e.mapping.map(a.before()),f)}t&&Ut(n,r.extensionManager.splittableMarks),e.scrollIntoView()}return h},Ds=(t,e={})=>({tr:n,state:s,dispatch:r,editor:o})=>{var i;const a=C(t,s.schema),{$from:l,$to:c}=s.selection,u=s.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const f=o.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(r){let m=st.empty;const b=l.index(-1)?1:l.index(-2)?2:3;for(let P=l.depth-b;P>=l.depth-3;P-=1)m=st.from(l.node(P).copy(m));const M=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,w={...ot(f,l.node().type.name,l.node().attrs),...e},x=((i=a.contentMatch.defaultType)===null||i===void 0?void 0:i.createAndFill(w))||void 0;m=m.append(st.from(a.createAndFill(null,x)||void 0));const E=l.before(l.depth-(b-1));n.replace(E,l.after(-M),new _e(m,4-b,0));let O=-1;n.doc.nodesBetween(E,n.doc.content.size,(P,T)=>{if(O>-1)return!1;P.isTextblock&&P.content.size===0&&(O=T+1)}),O>-1&&n.setSelection(H.near(n.doc.resolve(O))),n.scrollIntoView()}return!0}const p=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,h={...ot(f,d.type.name,d.attrs),...e},y={...ot(f,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const g=p?[{type:a,attrs:h},{type:p,attrs:y}]:[{type:a,attrs:h}];if(!rt(n.doc,l.pos,2))return!1;if(r){const{selection:m,storedMarks:b}=s,{splittableMarks:M}=o.extensionManager,w=b||m.$to.parentOffset&&m.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!w||!r)return!0;const x=w.filter(E=>M.includes(E.type.name));n.ensureMarks(x)}return!0},Mt=(t,e)=>{const n=It(i=>i.type===e)(t.selection);if(!n)return!0;const s=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(s===void 0)return!0;const r=t.doc.nodeAt(s);return n.node.type===(r==null?void 0:r.type)&&Pt(t.doc,n.pos)&&t.join(n.pos),!0},wt=(t,e)=>{const n=It(i=>i.type===e)(t.selection);if(!n)return!0;const s=t.doc.resolve(n.start).after(n.depth);if(s===void 0)return!0;const r=t.doc.nodeAt(s);return n.node.type===(r==null?void 0:r.type)&&Pt(t.doc,s)&&t.join(s),!0},Rs=(t,e,n,s={})=>({editor:r,tr:o,state:i,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:f}=r.extensionManager,p=C(t,i.schema),h=C(e,i.schema),{selection:y,storedMarks:g}=i,{$from:m,$to:b}=y,M=m.blockRange(b),w=g||y.$to.parentOffset&&y.$from.marks();if(!M)return!1;const x=It(E=>Kt(E.type.name,d))(y);if(M.depth>=1&&x&&M.depth-x.depth<=1){if(x.node.type===p)return c.liftListItem(h);if(Kt(x.node.type.name,d)&&p.validContent(x.node.content)&&a)return l().command(()=>(o.setNodeMarkup(x.pos,p),!0)).command(()=>Mt(o,p)).command(()=>wt(o,p)).run()}return!n||!w||!a?l().command(()=>u().wrapInList(p,s)?!0:c.clearNodes()).wrapInList(p,s).command(()=>Mt(o,p)).command(()=>wt(o,p)).run():l().command(()=>{const E=u().wrapInList(p,s),O=w.filter(P=>f.includes(P.type.name));return o.ensureMarks(O),E?!0:c.clearNodes()}).wrapInList(p,s).command(()=>Mt(o,p)).command(()=>wt(o,p)).run()},js=(t,e={},n={})=>({state:s,commands:r})=>{const{extendEmptyMarkRange:o=!1}=n,i=D(t,s.schema);return At(s,i,e)?r.unsetMark(i,{extendEmptyMarkRange:o}):r.setMark(i,e)},Fs=(t,e,n={})=>({state:s,commands:r})=>{const o=C(t,s.schema),i=C(e,s.schema),a=J(s,o,n);let l;return s.selection.$anchor.sameParent(s.selection.$head)&&(l=s.selection.$anchor.parent.attrs),a?r.setNode(i,l):r.setNode(o,{...l,...n})},zs=(t,e={})=>({state:n,commands:s})=>{const r=C(t,n.schema);return J(n,r,e)?s.lift(r):s.wrapIn(r,e)},qs=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let s=0;s<n.length;s+=1){const r=n[s];let o;if(r.spec.isInputRules&&(o=r.getState(t))){if(e){const i=t.tr,a=o.transform;for(let l=a.steps.length-1;l>=0;l-=1)i.step(a.steps[l].invert(a.docs[l]));if(o.text){const l=i.doc.resolve(o.from).marks();i.replaceWith(o.from,o.to,t.schema.text(o.text,l))}else i.delete(o.from,o.to)}return!0}}return!1},Ws=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:s,ranges:r}=n;return s||e&&r.forEach(o=>{t.removeMark(o.$from.pos,o.$to.pos)}),!0},Vs=(t,e={})=>({tr:n,state:s,dispatch:r})=>{var o;const{extendEmptyMarkRange:i=!1}=e,{selection:a}=n,l=D(t,s.schema),{$from:c,empty:u,ranges:d}=a;if(!r)return!0;if(u&&i){let{from:f,to:p}=a;const h=(o=c.marks().find(g=>g.type===l))===null||o===void 0?void 0:o.attrs,y=$t(c,l,h);y&&(f=y.from,p=y.to),n.removeMark(f,p,l)}else d.forEach(f=>{n.removeMark(f.$from.pos,f.$to.pos,l)});return n.removeStoredMark(l),!0},Ks=(t,e={})=>({tr:n,state:s,dispatch:r})=>{let o=null,i=null;const a=ft(typeof t=="string"?t:t.name,s.schema);return a?(a==="node"&&(o=C(t,s.schema)),a==="mark"&&(i=D(t,s.schema)),r&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;s.doc.nodesBetween(c,u,(d,f)=>{o&&o===d.type&&n.setNodeMarkup(f,void 0,{...d.attrs,...e}),i&&d.marks.length&&d.marks.forEach(p=>{if(i===p.type){const h=Math.max(f,c),y=Math.min(f+d.nodeSize,u);n.addMark(h,y,i.create({...p.attrs,...e}))}})})}),!0):!1},Us=(t,e={})=>({state:n,dispatch:s})=>{const r=C(t,n.schema);return ln(r,e)(n,s)},Qs=(t,e={})=>({state:n,dispatch:s})=>{const r=C(t,n.schema);return un(r,e)(n,s)};var Gs=Object.freeze({__proto__:null,blur:Cn,clearContent:Ln,clearNodes:Pn,command:On,createParagraphNear:$n,cut:In,deleteCurrentNode:Hn,deleteNode:Nn,deleteRange:Bn,deleteSelection:_n,enter:Dn,exitCode:Rn,extendMarkRange:Fn,first:zn,focus:qn,forEach:Wn,insertContent:Vn,insertContentAt:Qn,joinBackward:Xn,joinDown:Jn,joinForward:Yn,joinItemBackward:Zn,joinItemForward:ts,joinTextblockBackward:es,joinTextblockForward:ns,joinUp:Gn,keyboardShortcut:rs,lift:os,liftEmptyBlock:is,liftListItem:as,newlineInCode:ls,resetAttributes:cs,scrollIntoView:ds,selectAll:us,selectNodeBackward:ps,selectNodeForward:fs,selectParentNode:hs,selectTextblockEnd:ms,selectTextblockStart:gs,setContent:ys,setMark:Os,setMeta:$s,setNode:Is,setNodeSelection:Hs,setTextSelection:Ns,sinkListItem:Bs,splitBlock:_s,splitListItem:Ds,toggleList:Rs,toggleMark:js,toggleNode:Fs,toggleWrap:zs,undoInputRule:qs,unsetAllMarks:Ws,unsetMark:Vs,updateAttributes:Ks,wrapIn:Us,wrapInList:Qs});const Js=$.create({name:"commands",addCommands(){return{...Gs}}}),Xs=$.create({name:"editable",addProseMirrorPlugins(){return[new I({key:new N("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Ys=$.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new I({key:new N("focusEvents"),props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const s=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(s),!1},blur:(e,n)=>{t.isFocused=!1;const s=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(s),!1}}}})]}}),Zs=$.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:f,parent:p}=d,h=d.parent.isTextblock&&f>0?a.doc.resolve(f-1):d,y=h.parent.type.spec.isolating,g=d.pos-d.parentOffset,m=y&&h.parent.childCount===1?g===d.pos:F.atStart(c).from===f;return!u||!p.type.isTextblock||p.textContent.length||!m||m&&d.parent.type.name==="paragraph"?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},r={...s},o={...s,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return pt()||me()?o:r},addProseMirrorPlugins(){return[new I({key:new N("clearDocument"),appendTransaction:(t,e,n)=>{const s=t.some(y=>y.docChanged)&&!e.doc.eq(n.doc),r=t.some(y=>y.getMeta("preventClearDocument"));if(!s||r)return;const{empty:o,from:i,to:a}=e.selection,l=F.atStart(e.doc).from,c=F.atEnd(e.doc).to;if(o||!(i===l&&a===c)||!mt(n.doc))return;const f=n.tr,p=lt({state:n,transaction:f}),{commands:h}=new ct({editor:this.editor,state:p});if(h.clearNodes(),!!f.steps.length)return f}})]}}),tr=$.create({name:"tabindex",addProseMirrorPlugins(){return[new I({key:new N("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class R{get name(){return this.node.type.name}constructor(e,n,s=!1,r=null){this.currentNode=null,this.actualDepth=null,this.isBlock=s,this.resolvedPos=e,this.editor=n,this.currentNode=r}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,s=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,s=this.to-1}this.editor.commands.insertContentAt({from:n,to:s},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new R(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new R(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new R(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,s)=>{const r=n.isBlock&&!n.isTextblock,o=this.pos+s+1,i=this.resolvedPos.doc.resolve(o);if(!r&&i.depth<=this.depth)return;const a=new R(i,this.editor,r,r?n:null);r&&(a.actualDepth=this.depth+1),e.push(new R(i,this.editor,r,r?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let s=null,r=this.parent;for(;r&&!s;){if(r.node.type.name===e)if(Object.keys(n).length>0){const o=r.node.attrs,i=Object.keys(n);for(let a=0;a<i.length;a+=1){const l=i[a];if(o[l]!==n[l])break}}else s=r;r=r.parent}return s}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},s=!1){let r=[];if(!this.children||this.children.length===0)return r;const o=Object.keys(n);return this.children.forEach(i=>{s&&r.length>0||(i.node.type.name===e&&o.every(l=>n[l]===i.node.attrs[l])&&r.push(i),!(s&&r.length>0)&&(r=r.concat(i.querySelectorAll(e,n,s))))}),r}setAttribute(e){const n=this.editor.state.selection;this.editor.chain().setTextSelection(this.from).updateAttributes(this.node.type.name,e).setTextSelection(n.from).run()}}const er=t=>new I({key:new N("tiptapDrop"),props:{handleDrop:(e,n,s,r)=>{t(n,s,r)}}}),nr=t=>new I({key:new N("tiptapPaste"),props:{handlePaste:(e,n,s)=>{t(n,s)}}}),sr=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function rr(t,e,n){const s=document.querySelector("style[data-tiptap-style]");if(s!==null)return s;const r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute("data-tiptap-style",""),r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r),r}let or=class extends pn{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.options.onPaste&&this.registerPlugin(nr(this.options.onPaste)),this.options.onDrop&&this.registerPlugin(er(this.options.onDrop)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=rr(sr,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const s=ce(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],r=this.state.reconfigure({plugins:s});return this.view.updateState(r),r}unregisterPlugin(e){if(this.isDestroyed)return;const n=typeof e=="string"?`${e}$`:e.key,s=this.state.reconfigure({plugins:this.state.plugins.filter(r=>!r.key.startsWith(n))});return this.view.updateState(s),s}createExtensionManager(){var e,n;const r=[...this.options.enableCoreExtensions?[Xs,En.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),Js,Ys,Zs,tr].filter(o=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[o.name]!==!1:!0):[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o==null?void 0:o.type));this.extensionManager=new W(r,this)}createCommandManager(){this.commandManager=new ct({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){let e;try{e=xt(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.options.extensions=this.options.extensions.filter(i=>i.name!=="collaboration"),this.createExtensionManager()}}),e=xt(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const n=fe(e,this.options.autofocus);this.view=new Ne(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:Ee.create({doc:e,selection:n||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const r=this.view.dom;r.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(i=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(i)});return}const n=this.state.apply(e),s=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),s&&this.emit("selectionUpdate",{editor:this,transaction:e});const r=e.getMeta("focus"),o=e.getMeta("blur");r&&this.emit("focus",{editor:this,event:r.event,transaction:e}),o&&this.emit("blur",{editor:this,event:o.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return ge(this.state,e)}isActive(e,n){const s=typeof e=="string"?e:null,r=typeof e=="string"?n:e;return Cs(this.state,s,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return ws(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:s={}}=e||{};return Ss(this.state.doc,{blockSeparator:n,textSerializers:{...ue(this.schema),...s}})}get isEmpty(){return mt(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelector(e,n))||null}$nodes(e,n){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new R(n,this)}get $doc(){return this.$pos(0)}};function K(t){return new Y({find:t.find,handler:({state:e,range:n,match:s})=>{const r=k(t.getAttributes,void 0,s);if(r===!1||r===null)return null;const{tr:o}=e,i=s[s.length-1],a=s[0];if(i){const l=a.search(/\S/),c=n.from+a.indexOf(i),u=c+i.length;if(Ht(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(y=>y===t.type&&y!==p.mark.type)).filter(p=>p.to>c).length)return null;u<n.to&&o.delete(u,n.to),c>n.from&&o.delete(n.from+l,c);const f=n.from+l+i.length;o.addMark(n.from+l,f,t.type.create(r||{})),o.removeStoredMark(t.type)}}})}function ye(t){return new Y({find:t.find,handler:({state:e,range:n,match:s})=>{const r=k(t.getAttributes,void 0,s)||{},{tr:o}=e,i=n.from;let a=n.to;const l=t.type.create(r);if(s[1]){const c=s[0].lastIndexOf(s[1]);let u=i+c;u>a?u=a:a=u+s[1].length;const d=s[0][s[0].length-1];o.insertText(d,i+s[0].length-1),o.replaceWith(u,a,l)}else if(s[0]){const c=t.type.isInline?i:i-1;o.insert(c,t.type.create(r)).delete(o.mapping.map(i),o.mapping.map(a))}o.scrollIntoView()}})}function Et(t){return new Y({find:t.find,handler:({state:e,range:n,match:s})=>{const r=e.doc.resolve(n.from),o=k(t.getAttributes,void 0,s)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,o)}})}function A(t){return new Y({find:t.find,handler:({state:e,range:n,match:s})=>{let r=t.replace,o=n.from;const i=n.to;if(s[1]){const a=s[0].lastIndexOf(s[1]);r+=s[0].slice(a+s[1].length),o+=a;const l=o-i;l>0&&(r=s[0].slice(a-l,a)+r,o=i)}e.tr.insertText(r,o,i)}})}function X(t){return new Y({find:t.find,handler:({state:e,range:n,match:s,chain:r})=>{const o=k(t.getAttributes,void 0,s)||{},i=e.tr.delete(n.from,n.to),l=i.doc.resolve(n.from).blockRange(),c=l&&Re(l,t.type,o);if(!c)return null;if(i.wrap(l,c),t.keepMarks&&t.editor){const{selection:d,storedMarks:f}=e,{splittableMarks:p}=t.editor.extensionManager,h=f||d.$to.parentOffset&&d.$from.marks();if(h){const y=h.filter(g=>p.includes(g.type.name));i.ensureMarks(y)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";r().updateAttributes(d,o).run()}const u=i.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&Pt(i.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(s,u))&&i.join(n.from-1)}})}class _{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=k(v(this,"addOptions",{name:this.name}))),this.storage=k(v(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new _(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>ut(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new _(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=k(v(n,"addOptions",{name:n.name})),n.storage=k(v(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:s}=e.state,r=e.state.selection.$from;if(r.pos===r.end()){const i=r.marks();if(!!!i.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=i.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&s.removeStoredMark(l),s.insertText(" ",r.pos),e.view.dispatch(s),!0}return!1}}class L{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=k(v(this,"addOptions",{name:this.name}))),this.storage=k(v(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new L(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>ut(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new L(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=k(v(n,"addOptions",{name:n.name})),n.storage=k(v(n,"addStorage",{name:n.name,options:n.options})),n}}function ir(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}class ar{constructor(e,n,s){this.isDragging=!1,this.component=e,this.editor=n.editor,this.options={stopEvent:null,ignoreMutation:null,...s},this.extension=n.extension,this.node=n.node,this.decorations=n.decorations,this.innerDecorations=n.innerDecorations,this.view=n.view,this.HTMLAttributes=n.HTMLAttributes,this.getPos=n.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var n,s,r,o,i,a,l;const{view:c}=this.editor,u=e.target,d=u.nodeType===3?(n=u.parentElement)===null||n===void 0?void 0:n.closest("[data-drag-handle]"):u.closest("[data-drag-handle]");if(!this.dom||!((s=this.contentDOM)===null||s===void 0)&&s.contains(u)||!d)return;let f=0,p=0;if(this.dom!==d){const m=this.dom.getBoundingClientRect(),b=d.getBoundingClientRect(),M=(r=e.offsetX)!==null&&r!==void 0?r:(o=e.nativeEvent)===null||o===void 0?void 0:o.offsetX,w=(i=e.offsetY)!==null&&i!==void 0?i:(a=e.nativeEvent)===null||a===void 0?void 0:a.offsetY;f=b.x-m.x+M,p=b.y-m.y+w}(l=e.dataTransfer)===null||l===void 0||l.setDragImage(this.dom,f,p);const h=this.getPos();if(typeof h!="number")return;const y=V.create(c.state.doc,h),g=c.state.tr.setSelection(y);c.dispatch(g)}stopEvent(e){var n;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const s=e.target;if(!(this.dom.contains(s)&&!(!((n=this.contentDOM)===null||n===void 0)&&n.contains(s))))return!1;const o=e.type.startsWith("drag"),i=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(s.tagName)||s.isContentEditable)&&!i&&!o)return!0;const{isEditable:l}=this.editor,{isDragging:c}=this,u=!!this.node.type.spec.draggable,d=V.isSelectable(this.node),f=e.type==="copy",p=e.type==="paste",h=e.type==="cut",y=e.type==="mousedown";if(!u&&d&&o&&e.preventDefault(),u&&o&&!c)return e.preventDefault(),!1;if(u&&l&&!c&&y){const g=s.closest("[data-drag-handle]");g&&(this.dom===g||this.dom.contains(g))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(c||i||f||p||h||y&&d)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(pt()||ir())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(s=>s.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:n})=>{const s=this.getPos();return typeof s!="number"?!1:(n.setNodeMarkup(s,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const n=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:n})}}function z(t){return new kn({find:t.find,handler:({state:e,range:n,match:s,pasteEvent:r})=>{const o=k(t.getAttributes,void 0,s,r);if(o===!1||o===null)return null;const{tr:i}=e,a=s[s.length-1],l=s[0];let c=n.to;if(a){const u=l.search(/\S/),d=n.from+l.indexOf(a),f=d+a.length;if(Ht(n.from,n.to,e.doc).filter(h=>h.mark.type.excluded.find(g=>g===t.type&&g!==h.mark.type)).filter(h=>h.to>d).length)return null;f<n.to&&i.delete(f,n.to),d>n.from&&i.delete(n.from+u,d),c=n.from+u+a.length,i.addMark(n.from+u,c,t.type.create(o||{})),i.removeStoredMark(t.type)}}})}function lr(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function Qt(t){return Ae((e,n)=>({get(){return e(),t},set(s){t=s,requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})})}}))}class cr extends or{constructor(e={}){return super(e),this.contentComponent=null,this.appContext=null,this.reactiveState=Qt(this.view.state),this.reactiveExtensionStorage=Qt(this.extensionStorage),this.on("beforeTransaction",({nextState:n})=>{this.reactiveState.value=n,this.reactiveExtensionStorage.value=this.extensionStorage}),ne(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,n){const s=super.registerPlugin(e,n);return this.reactiveState&&(this.reactiveState.value=s),s}unregisterPlugin(e){const n=super.unregisterPlugin(e);return this.reactiveState&&n&&(this.reactiveState.value=n),n}}const Ro=Ct({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(t){const e=te(),n=xe();return ve(()=>{const s=t.editor;s&&s.options.element&&e.value&&ke(()=>{if(!e.value||!s.options.element.firstChild)return;const r=Me(e.value);e.value.append(...s.options.element.childNodes),s.contentComponent=n.ctx._,n&&(s.appContext={...n.appContext,provides:n.provides}),s.setOptions({element:r}),s.createNodeViews()})}),ee(()=>{const s=t.editor;if(!s||(s.isDestroyed||s.view.setProps({nodeViews:{}}),s.contentComponent=null,s.appContext=null,!s.options.element.firstChild))return;const r=document.createElement("div");r.append(...s.options.element.childNodes),s.setOptions({element:r})}),{rootEl:e}},render(){return Lt("div",{ref:t=>{this.rootEl=t}})}}),jo=Ct({name:"NodeViewWrapper",props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var t,e;return Lt(this.as,{class:this.decorationClasses,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(e=(t=this.$slots).default)===null||e===void 0?void 0:e.call(t))}}),Fo=(t={})=>{const e=we();return Se(()=>{e.value=new cr(t)}),ee(()=>{var n;(n=e.value)===null||n===void 0||n.destroy()}),e};class dr{constructor(e,{props:n={},editor:s}){this.editor=s,this.component=ne(e),this.el=document.createElement("div"),this.props=Te(n),this.renderedComponent=this.renderComponent()}get element(){return this.renderedComponent.el}get ref(){var e,n,s,r;return!((n=(e=this.renderedComponent.vNode)===null||e===void 0?void 0:e.component)===null||n===void 0)&&n.exposed?this.renderedComponent.vNode.component.exposed:(r=(s=this.renderedComponent.vNode)===null||s===void 0?void 0:s.component)===null||r===void 0?void 0:r.proxy}renderComponent(){let e=Lt(this.component,this.props);return this.editor.appContext&&(e.appContext=this.editor.appContext),typeof document<"u"&&this.el&&Rt(e,this.el),{vNode:e,destroy:()=>{this.el&&Rt(null,this.el),this.el=null,e=null},el:this.el?this.el.firstElementChild:null}}updateProps(e={}){Object.entries(e).forEach(([n,s])=>{this.props[n]=s}),this.renderComponent()}destroy(){this.renderedComponent.destroy()}}const zo={editor:{type:Object,required:!0},node:{type:Object,required:!0},decorations:{type:Object,required:!0},selected:{type:Boolean,required:!0},extension:{type:Object,required:!0},getPos:{type:Function,required:!0},updateAttributes:{type:Function,required:!0},deleteNode:{type:Function,required:!0}};class ur extends ar{mount(){const e={editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(r={})=>this.updateAttributes(r),deleteNode:()=>this.deleteNode()},n=this.onDragStart.bind(this);this.decorationClasses=te(this.getDecorationClasses());const s=Ct({extends:{...this.component},props:Object.keys(e),template:this.component.template,setup:r=>{var o,i;return Dt("onDragStart",n),Dt("decorationClasses",this.decorationClasses),(i=(o=this.component).setup)===null||i===void 0?void 0:i.call(o,r,{expose:()=>{}})},__scopeId:this.component.__scopeId,__cssModules:this.component.__cssModules,__name:this.component.__name,__file:this.component.__file});this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.renderer=new dr(s,{editor:this.editor,props:e})}get dom(){if(!this.renderer.element||!this.renderer.element.hasAttribute("data-node-view-wrapper"))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.dom.querySelector("[data-node-view-content]")}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection,s=this.getPos();if(typeof s=="number")if(e<=s&&n>=s+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n,s){const r=o=>{this.decorationClasses.value=this.getDecorationClasses(),this.renderer.updateProps(o)};if(typeof this.options.update=="function"){const o=this.node,i=this.decorations,a=this.innerDecorations;return this.node=e,this.decorations=n,this.innerDecorations=s,this.options.update({oldNode:o,oldDecorations:i,newNode:e,newDecorations:n,oldInnerDecorations:a,innerDecorations:s,updateProps:()=>r({node:e,decorations:n,innerDecorations:s})})}return e.type!==this.node.type?!1:(e===this.node&&this.decorations===n&&this.innerDecorations===s||(this.node=e,this.decorations=n,this.innerDecorations=s,r({node:e,decorations:n,innerDecorations:s})),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element&&this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element&&this.renderer.element.classList.remove("ProseMirror-selectednode")}getDecorationClasses(){return this.decorations.map(e=>e.type.attrs.class).flat().join(" ")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate)}}function qo(t,e){return n=>{if(!n.editor.contentComponent)return{};const s=typeof t=="function"&&"__vccOpts"in t?t.__vccOpts:t;return new ur(s,n,e)}}const pr=/^\s*>\s$/,fr=L.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[X({find:pr,type:this.type})]}}),hr=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,mr=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,gr=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,yr=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,br=_.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[K({find:hr,type:this.type}),K({find:gr,type:this.type})]},addPasteRules(){return[z({find:mr,type:this.type}),z({find:yr,type:this.type})]}}),vr=L.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",S(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Gt=_.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["span",S(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:t,commands:e})=>{const n=ht(t,this.type);return Object.entries(n).some(([,r])=>!!r)?!0:e.unsetMark(this.name)}}}}),Jt=/^\s*([-+*])\s$/,kr=L.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",S(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(vr.name,this.editor.getAttributes(Gt.name)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=X({find:Jt,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=X({find:Jt,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Gt.name),editor:this.editor})),[t]}}),Mr=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))$/,wr=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))/g,Sr=_.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[K({find:Mr,type:this.type})]},addPasteRules(){return[z({find:wr,type:this.type})]}}),Tr=/^```([a-z]+)?[\s\n]$/,xr=/^~~~([a-z]+)?[\s\n]$/,Ar=L.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,o=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(i=>i.startsWith(n)).map(i=>i.replace(n,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",S(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:s,empty:r}=n;if(!r||s.parent.type!==this.type)return!1;const o=s.parentOffset===s.parent.nodeSize-2,i=s.parent.textContent.endsWith(`

`);return!o||!i?!1:t.chain().command(({tr:a})=>(a.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:s}=e,{$from:r,empty:o}=n;if(!o||r.parent.type!==this.type||!(r.parentOffset===r.parent.nodeSize-2))return!1;const a=r.after();return a===void 0?!1:s.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(F.near(s.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[Et({find:Tr,type:this.type,getAttributes:t=>({language:t[1]})}),Et({find:xr,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new I({key:new N("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("vscode-editor-data"),r=s?JSON.parse(s):void 0,o=r==null?void 0:r.mode;if(!n||!o)return!1;const{tr:i,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return i.replaceSelectionWith(this.type.create({language:o},l)),i.selection.$from.parent.type!==this.type&&i.setSelection(H.near(i.doc.resolve(Math.max(0,i.selection.from-2)))),i.setMeta("paste",!0),t.dispatch(i),!0}}})]}}),Er=L.create({name:"doc",topNode:!0,content:"block+"}),Cr=$.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Ce(this.options)]}}),Lr=$.create({name:"gapCursor",addProseMirrorPlugins(){return[Le()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=k(v(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),Pr=L.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",S(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:s})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:r,storedMarks:o}=n;if(r.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:a}=s.extensionManager,l=o||r.$to.parentOffset&&r.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&i){const d=l.filter(f=>a.includes(f.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Or=L.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,S(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Et({find:new RegExp(`^(#{1,${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),$r=$.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>Pe(t,e),redo:()=>({state:t,dispatch:e})=>Oe(t,e)}},addProseMirrorPlugins(){return[$e(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),Ir=L.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",S(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{const{selection:n}=e,{$from:s,$to:r}=n,o=t();return s.parentOffset===0?o.insertContentAt({from:Math.max(s.pos-1,0),to:r.pos},{type:this.name}):Ls(n)?o.insertContentAt(r.pos,{type:this.name}):o.insertContent({type:this.name}),o.command(({tr:i,dispatch:a})=>{var l;if(a){const{$to:c}=i.selection,u=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?i.setSelection(H.create(i.doc,c.pos+1)):c.nodeAfter.isBlock?i.setSelection(V.create(i.doc,c.pos)):i.setSelection(H.create(i.doc,c.pos));else{const d=(l=c.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();d&&(i.insert(u,d),i.setSelection(H.create(i.doc,u+1)))}i.scrollIntoView()}return!0}).run()}}},addInputRules(){return[ye({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),Hr=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Nr=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Br=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,_r=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Dr=_.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[K({find:Hr,type:this.type}),K({find:Br,type:this.type})]},addPasteRules(){return[z({find:Nr,type:this.type}),z({find:_r,type:this.type})]}}),Rr=L.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",S(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),jr=L.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",S(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Xt=_.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["span",S(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:t,commands:e})=>{const n=ht(t,this.type);return Object.entries(n).some(([,r])=>!!r)?!0:e.unsetMark(this.name)}}}}),Yt=/^(\d+)\.\s$/,Fr=L.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:void 0,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",S(this.options.HTMLAttributes,n),0]:["ol",S(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(jr.name,this.editor.getAttributes(Xt.name)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=X({find:Yt,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=X({find:Yt,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(Xt.name)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),zr=L.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),qr=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Wr=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Vr=_.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[K({find:qr,type:this.type})]},addPasteRules(){return[z({find:Wr,type:this.type})]}}),Kr=L.create({name:"text",group:"inline"}),Wo=$.create({name:"starterKit",addExtensions(){var t,e,n,s,r,o,i,a,l,c,u,d,f,p,h,y,g,m;const b=[];return this.options.bold!==!1&&b.push(br.configure((t=this.options)===null||t===void 0?void 0:t.bold)),this.options.blockquote!==!1&&b.push(fr.configure((e=this.options)===null||e===void 0?void 0:e.blockquote)),this.options.bulletList!==!1&&b.push(kr.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&b.push(Sr.configure((s=this.options)===null||s===void 0?void 0:s.code)),this.options.codeBlock!==!1&&b.push(Ar.configure((r=this.options)===null||r===void 0?void 0:r.codeBlock)),this.options.document!==!1&&b.push(Er.configure((o=this.options)===null||o===void 0?void 0:o.document)),this.options.dropcursor!==!1&&b.push(Cr.configure((i=this.options)===null||i===void 0?void 0:i.dropcursor)),this.options.gapcursor!==!1&&b.push(Lr.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&b.push(Pr.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&b.push(Or.configure((c=this.options)===null||c===void 0?void 0:c.heading)),this.options.history!==!1&&b.push($r.configure((u=this.options)===null||u===void 0?void 0:u.history)),this.options.horizontalRule!==!1&&b.push(Ir.configure((d=this.options)===null||d===void 0?void 0:d.horizontalRule)),this.options.italic!==!1&&b.push(Dr.configure((f=this.options)===null||f===void 0?void 0:f.italic)),this.options.listItem!==!1&&b.push(Rr.configure((p=this.options)===null||p===void 0?void 0:p.listItem)),this.options.orderedList!==!1&&b.push(Fr.configure((h=this.options)===null||h===void 0?void 0:h.orderedList)),this.options.paragraph!==!1&&b.push(zr.configure((y=this.options)===null||y===void 0?void 0:y.paragraph)),this.options.strike!==!1&&b.push(Vr.configure((g=this.options)===null||g===void 0?void 0:g.strike)),this.options.text!==!1&&b.push(Kr.configure((m=this.options)===null||m===void 0?void 0:m.text)),b}}),Vo=_.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),Ko=$.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:"left"}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>{const e=t.style.textAlign||this.options.defaultAlignment;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:t=>t.textAlign===this.options.defaultAlignment?{}:{style:`text-align: ${t.textAlign}`}}}}]},addCommands(){return{setTextAlign:t=>({commands:e})=>this.options.alignments.includes(t)?this.options.types.map(n=>e.updateAttributes(n,{textAlign:t})).every(n=>n):!1,unsetTextAlign:()=>({commands:t})=>this.options.types.map(e=>t.resetAttributes(e,"textAlign")).every(e=>e)}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),Ur=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Uo=L.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",S(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[ye({find:Ur,type:this.type,getAttributes:t=>{const[,,e,n,s]=t;return{src:n,alt:e,title:s}}})]}});function Qr(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function Gr(t){return new I({key:new N("autolink"),appendTransaction:(e,n,s)=>{const r=e.some(c=>c.docChanged)&&!n.doc.eq(s.doc),o=e.some(c=>c.getMeta("preventAutolink"));if(!r||o)return;const{tr:i}=s,a=bs(n.doc,[...e]);if(Es(a).forEach(({newRange:c})=>{const u=ks(s.doc,c,p=>p.isTextblock);let d,f;if(u.length>1?(d=u[0],f=s.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ")):u.length&&s.doc.textBetween(c.from,c.to," "," ").endsWith(" ")&&(d=u[0],f=s.doc.textBetween(d.pos,c.to,void 0," ")),d&&f){const p=f.split(" ").filter(m=>m!=="");if(p.length<=0)return!1;const h=p[p.length-1],y=d.pos+f.lastIndexOf(h);if(!h)return!1;const g=Ie(h).map(m=>m.toObject(t.defaultProtocol));if(!Qr(g))return!1;g.filter(m=>m.isLink).map(m=>({...m,from:y+m.start+1,to:y+m.end+1})).filter(m=>s.schema.marks.code?!s.doc.rangeHasMark(m.from,m.to,s.schema.marks.code):!0).filter(m=>t.validate(m.value)).forEach(m=>{Ht(m.from,m.to,s.doc).some(b=>b.mark.type===t.type)||i.addMark(m.from,m.to,t.type.create({href:m.href}))})}}),!!i.steps.length)return i}})}function Jr(t){return new I({key:new N("handleClickLink"),props:{handleClick:(e,n,s)=>{var r,o;if(s.button!==0||!e.editable)return!1;let i=s.target;const a=[];for(;i.nodeName!=="DIV";)a.push(i),i=i.parentNode;if(!a.find(f=>f.nodeName==="A"))return!1;const l=ge(e.state,t.type.name),c=s.target,u=(r=c==null?void 0:c.href)!==null&&r!==void 0?r:l.href,d=(o=c==null?void 0:c.target)!==null&&o!==void 0?o:l.target;return c&&u?(window.open(u,d),!0):!1}}})}function Xr(t){return new I({key:new N("handlePasteLink"),props:{handlePaste:(e,n,s)=>{const{state:r}=e,{selection:o}=r,{empty:i}=o;if(i)return!1;let a="";s.content.forEach(c=>{a+=c.textContent});const l=se(a,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===a);return!a||!l?!1:(t.editor.commands.setMark(t.type,{href:l.href}),!0)}}})}const Yr=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;function Zt(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(s=>{const r=typeof s=="string"?s:s.scheme;r&&n.push(r)}),!t||t.replace(Yr,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z+.-]+(?:[^a-z+.-:]|$))`,"i"))}const Qo=_.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.protocols.forEach(t=>{if(typeof t=="string"){jt(t);return}jt(t.scheme,t.optionalSlashes)})},onDestroy(){He()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!Zt(e,this.options.protocols)?!1:null}}]},renderHTML({HTMLAttributes:t}){return Zt(t.href,this.options.protocols)?["a",S(this.options.HTMLAttributes,t),0]:["a",S(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>e().setMark(this.name,t).setMeta("preventAutolink",!0).run(),toggleLink:t=>({chain:e})=>e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[z({find:t=>{const e=[];if(t){const{validate:n}=this.options,s=se(t).filter(r=>r.isLink&&n(r.value));s.length&&s.forEach(r=>e.push({text:r.value,data:{href:r.href},index:r.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[];return this.options.autolink&&t.push(Gr({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:this.options.validate})),this.options.openOnClick===!0&&t.push(Jr({type:this.type})),this.options.linkOnPaste&&t.push(Xr({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}}),Go=$.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new I({key:new N("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=e,r=[];if(!n)return null;const o=this.editor.isEmpty;return t.descendants((i,a)=>{const l=s>=a&&s<=a+i.nodeSize,c=!i.isLeaf&&mt(i);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];o&&u.push(this.options.emptyEditorClass);const d=re.node(a,a+i.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:i,pos:a,hasAnchor:l}):this.options.placeholder});r.push(d)}return this.options.includeChildren}),oe.create(t,r)}}})]}}),Zr=t=>A({find:/--$/,replace:t??"—"}),to=t=>A({find:/\.\.\.$/,replace:t??"…"}),eo=t=>A({find:/(?:^|[\s{[(<'"\u2018\u201C])(")$/,replace:t??"“"}),no=t=>A({find:/"$/,replace:t??"”"}),so=t=>A({find:/(?:^|[\s{[(<'"\u2018\u201C])(')$/,replace:t??"‘"}),ro=t=>A({find:/'$/,replace:t??"’"}),oo=t=>A({find:/<-$/,replace:t??"←"}),io=t=>A({find:/->$/,replace:t??"→"}),ao=t=>A({find:/\(c\)$/,replace:t??"©"}),lo=t=>A({find:/\(tm\)$/,replace:t??"™"}),co=t=>A({find:/\(sm\)$/,replace:t??"℠"}),uo=t=>A({find:/\(r\)$/,replace:t??"®"}),po=t=>A({find:/(?:^|\s)(1\/2)\s$/,replace:t??"½"}),fo=t=>A({find:/\+\/-$/,replace:t??"±"}),ho=t=>A({find:/!=$/,replace:t??"≠"}),mo=t=>A({find:/<<$/,replace:t??"«"}),go=t=>A({find:/>>$/,replace:t??"»"}),yo=t=>A({find:/\d+\s?([*x])\s?\d+$/,replace:t??"×"}),bo=t=>A({find:/\^2$/,replace:t??"²"}),vo=t=>A({find:/\^3$/,replace:t??"³"}),ko=t=>A({find:/(?:^|\s)(1\/4)\s$/,replace:t??"¼"}),Mo=t=>A({find:/(?:^|\s)(3\/4)\s$/,replace:t??"¾"}),Jo=$.create({name:"typography",addOptions(){return{closeDoubleQuote:"”",closeSingleQuote:"’",copyright:"©",ellipsis:"…",emDash:"—",laquo:"«",leftArrow:"←",multiplication:"×",notEqual:"≠",oneHalf:"½",oneQuarter:"¼",openDoubleQuote:"“",openSingleQuote:"‘",plusMinus:"±",raquo:"»",registeredTrademark:"®",rightArrow:"→",servicemark:"℠",superscriptThree:"³",superscriptTwo:"²",threeQuarters:"¾",trademark:"™"}},addInputRules(){const t=[];return this.options.emDash!==!1&&t.push(Zr(this.options.emDash)),this.options.ellipsis!==!1&&t.push(to(this.options.ellipsis)),this.options.openDoubleQuote!==!1&&t.push(eo(this.options.openDoubleQuote)),this.options.closeDoubleQuote!==!1&&t.push(no(this.options.closeDoubleQuote)),this.options.openSingleQuote!==!1&&t.push(so(this.options.openSingleQuote)),this.options.closeSingleQuote!==!1&&t.push(ro(this.options.closeSingleQuote)),this.options.leftArrow!==!1&&t.push(oo(this.options.leftArrow)),this.options.rightArrow!==!1&&t.push(io(this.options.rightArrow)),this.options.copyright!==!1&&t.push(ao(this.options.copyright)),this.options.trademark!==!1&&t.push(lo(this.options.trademark)),this.options.servicemark!==!1&&t.push(co(this.options.servicemark)),this.options.registeredTrademark!==!1&&t.push(uo(this.options.registeredTrademark)),this.options.oneHalf!==!1&&t.push(po(this.options.oneHalf)),this.options.plusMinus!==!1&&t.push(fo(this.options.plusMinus)),this.options.notEqual!==!1&&t.push(ho(this.options.notEqual)),this.options.laquo!==!1&&t.push(mo(this.options.laquo)),this.options.raquo!==!1&&t.push(go(this.options.raquo)),this.options.multiplication!==!1&&t.push(yo(this.options.multiplication)),this.options.superscriptTwo!==!1&&t.push(bo(this.options.superscriptTwo)),this.options.superscriptThree!==!1&&t.push(vo(this.options.superscriptThree)),this.options.oneQuarter!==!1&&t.push(ko(this.options.oneQuarter)),this.options.threeQuarters!==!1&&t.push(Mo(this.options.threeQuarters)),t}});function wo(t){var e;const{char:n,allowSpaces:s,allowedPrefixes:r,startOfLine:o,$position:i}=t,a=lr(n),l=new RegExp(`\\s${a}$`),c=o?"^":"",u=s?new RegExp(`${c}${a}.*?(?=\\s${a}|$)`,"gm"):new RegExp(`${c}(?:^)?${a}[^\\s${a}]*`,"gm"),d=((e=i.nodeBefore)===null||e===void 0?void 0:e.isText)&&i.nodeBefore.text;if(!d)return null;const f=i.pos-d.length,p=Array.from(d.matchAll(u)).pop();if(!p||p.input===void 0||p.index===void 0)return null;const h=p.input.slice(Math.max(0,p.index-1),p.index),y=new RegExp(`^[${r==null?void 0:r.join("")}\0]?$`).test(h);if(r!==null&&!y)return null;const g=f+p.index;let m=g+p[0].length;return s&&l.test(d.slice(m-1,m+1))&&(p[0]+=" ",m+=1),g<i.pos&&m>=i.pos?{range:{from:g,to:m},query:p[0].slice(n.length),text:p[0]}:null}const So=new N("suggestion");function To({pluginKey:t=So,editor:e,char:n="@",allowSpaces:s=!1,allowedPrefixes:r=[" "],startOfLine:o=!1,decorationTag:i="span",decorationClass:a="suggestion",command:l=()=>null,items:c=()=>[],render:u=()=>({}),allow:d=()=>!0,findSuggestionMatch:f=wo}){let p;const h=u==null?void 0:u(),y=new I({key:t,view(){return{update:async(g,m)=>{var b,M,w,x,E,O,P;const T=(b=this.key)===null||b===void 0?void 0:b.getState(m),B=(M=this.key)===null||M===void 0?void 0:M.getState(g.state),U=T.active&&B.active&&T.range.from!==B.range.from,Nt=!T.active&&B.active,Bt=T.active&&!B.active,gt=!Nt&&!Bt&&T.query!==B.query,Q=Nt||U&&gt,Z=gt||U,yt=Bt||U&&gt;if(!Q&&!Z&&!yt)return;const q=yt&&!Q?T:B,_t=g.dom.querySelector(`[data-decoration-id="${q.decorationId}"]`);p={editor:e,range:q.range,query:q.query,text:q.text,items:[],command:G=>l({editor:e,range:q.range,props:G}),decorationNode:_t,clientRect:_t?()=>{var G;const{decorationId:be}=(G=this.key)===null||G===void 0?void 0:G.getState(e.state),bt=g.dom.querySelector(`[data-decoration-id="${be}"]`);return(bt==null?void 0:bt.getBoundingClientRect())||null}:null},Q&&((w=h==null?void 0:h.onBeforeStart)===null||w===void 0||w.call(h,p)),Z&&((x=h==null?void 0:h.onBeforeUpdate)===null||x===void 0||x.call(h,p)),(Z||Q)&&(p.items=await c({editor:e,query:q.query})),yt&&((E=h==null?void 0:h.onExit)===null||E===void 0||E.call(h,p)),Z&&((O=h==null?void 0:h.onUpdate)===null||O===void 0||O.call(h,p)),Q&&((P=h==null?void 0:h.onStart)===null||P===void 0||P.call(h,p))},destroy:()=>{var g;p&&((g=h==null?void 0:h.onExit)===null||g===void 0||g.call(h,p))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(g,m,b,M){const{isEditable:w}=e,{composing:x}=e.view,{selection:E}=g,{empty:O,from:P}=E,T={...m};if(T.composing=x,w&&(O||e.view.composing)){(P<m.range.from||P>m.range.to)&&!x&&!m.composing&&(T.active=!1);const B=f({char:n,allowSpaces:s,allowedPrefixes:r,startOfLine:o,$position:E.$from}),U=`id_${Math.floor(Math.random()*4294967295)}`;B&&d({editor:e,state:M,range:B.range,isActive:m.active})?(T.active=!0,T.decorationId=m.decorationId?m.decorationId:U,T.range=B.range,T.query=B.query,T.text=B.text):T.active=!1}else T.active=!1;return T.active||(T.decorationId=null,T.range={from:0,to:0},T.query=null,T.text=null),T}},props:{handleKeyDown(g,m){var b;const{active:M,range:w}=y.getState(g.state);return M&&((b=h==null?void 0:h.onKeyDown)===null||b===void 0?void 0:b.call(h,{view:g,event:m,range:w}))||!1},decorations(g){const{active:m,range:b,decorationId:M}=y.getState(g);return m?oe.create(g.doc,[re.inline(b.from,b.to,{nodeName:i,class:a,"data-decoration-id":M})]):null}}});return y}const xo=new N("mention"),Xo=L.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderText({options:t,node:e}){var n;return`${t.suggestion.char}${(n=e.attrs.label)!==null&&n!==void 0?n:e.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e}){var n;return["span",S(this.HTMLAttributes,t.HTMLAttributes),`${t.suggestion.char}${(n=e.attrs.label)!==null&&n!==void 0?n:e.attrs.id}`]},suggestion:{char:"@",pluginKey:xo,command:({editor:t,range:e,props:n})=>{var s,r,o;const i=t.view.state.selection.$to.nodeAfter;((s=i==null?void 0:i.text)===null||s===void 0?void 0:s.startsWith(" "))&&(e.to+=1),t.chain().focus().insertContentAt(e,[{type:this.name,attrs:n},{type:"text",text:" "}]).run(),(o=(r=t.view.dom.ownerDocument.defaultView)===null||r===void 0?void 0:r.getSelection())===null||o===void 0||o.collapseToEnd()},allow:({state:t,range:e})=>{const n=t.doc.resolve(e.from),s=t.schema.nodes[this.name];return!!n.parent.type.contentMatch.matchType(s)}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",S({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t})];const n={...this.options};n.HTMLAttributes=S({"data-type":this.name},this.options.HTMLAttributes,e);const s=this.options.renderHTML({options:n,node:t});return typeof s=="string"?["span",S({"data-type":this.name},this.options.HTMLAttributes,e),s]:s},renderText({node:t}){return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel({options:this.options,node:t})):this.options.renderText({options:this.options,node:t})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let n=!1;const{selection:s}=e,{empty:r,anchor:o}=s;return r?(e.doc.nodesBetween(o-1,o,(i,a)=>{if(i.type.name===this.name)return n=!0,t.insertText(this.options.deleteTriggerWithBackspace?"":this.options.suggestion.char||"",a,a+i.nodeSize),!1}),n):!1})}},addProseMirrorPlugins(){return[To({editor:this.editor,...this.options.suggestion})]}});export{Er as D,cr as E,$r as H,Uo as I,Qo as L,_ as M,jo as N,Go as P,Wo as S,Ko as T,Vo as U,qo as V,Ro as a,L as b,Kr as c,$ as d,dr as e,Pr as f,Jo as g,Xo as h,S as m,zo as n,Fo as u};
