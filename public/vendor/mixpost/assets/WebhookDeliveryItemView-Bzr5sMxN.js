import{u as M}from"./vue-i18n-CbxO4HOa.js";import{_ as f}from"./Flex-55yEXw9x.js";import{C as P}from"./Clock-BpaLntn3.js";import{X as V,Y as q,A as z,c as A,q as C}from"./app-D31ITXvg.js";import{b8 as H,k as i,y as h,z as n,E as a,x as s,G as N,l as k,C as v,A as l,u as J,t as F,aJ as R,r as j,f as W,w as G,b as S,ak as m,F as U}from"./@vue-DxEuNGre.js";import{H as I,j as X}from"./highlight.js-BQHIPuhb.js";import{p as Y}from"./pretty-kgrIdtEn.js";import{b as K}from"./js-beautify-CVGnPpPe.js";import{N as O}from"./nprogress-34pYfWsY.js";import{S as b}from"./SectionTitle-DlhdjqIe.js";import{_ as D}from"./SectionBorder-_k-DEA9C.js";import{R as E}from"./Refresh-BG68H2OY.js";import{O as Q}from"./@inertiajs-D-tiTHlX.js";import{u as Z}from"./useRouter-B_wMJENS.js";const ee={key:0,class:"text-red-500"},Re={__name:"WebhookDeliveryItem",props:{item:{type:Object,required:!0},active:{type:Boolean,default:!1}},emits:["click"],setup(t){const{t:o}=M(),d=t,y=()=>d.item.status==="ERROR"&&d.item.resend_at?o("webhook.delivery_failed_try_redeliver"):d.item.status==="ERROR"?o("webhook.delivery_failed"):"";return(w,g)=>{const u=H("tooltip");return i(),h(f,{onClick:g[0]||(g[0]=p=>w.$emit("click")),class:F([{"bg-gray-50":t.active},"px-md py-sm border-b last:border-b-0 border-gray-100 justify-between cursor-pointer hover:bg-gray-50 transition ease-in-out duration-200"])},{default:n(()=>[a(f,{gap:"gap-sm"},{default:n(()=>[s("div",null,[t.item.status==="ERROR"?N((i(),k("span",ee,[t.item.resend_at?(i(),h(P,{key:0})):(i(),h(V,{key:1}))])),[[u,y()]]):v("",!0),t.item.status==="SUCCESS"?(i(),h(q,{key:1,class:"text-green-500"})):v("",!0)]),s("div",null,l(J(o)(`webhook.event.${t.item.event}`)),1)]),_:1}),s("div",null,l(t.item.created_at),1)]),_:1},8,["class"])}}},te={class:"px-lg pt-lg"},se={key:0,class:"select-none"},oe={class:"px-lg"},re={class:"text-gray-500"},ae={class:"relative min-h-[50px]"},ie={key:1,class:"border-0 p-0 inline-grid"},ne=["innerHTML"],le={class:"px-lg pb-lg"},de={class:"relative min-h-[50px]"},ue={key:1,class:"border-0 p-0 inline-grid"},ce=["innerHTML"],je={__name:"WebhookDeliveryItemView",props:{webhookId:{type:String,required:!0},delivery:{type:Object,required:!0}},setup(t){I.registerLanguage("json",X);const o=t,d=R("routePrefix"),y=R("workspaceCtx"),{onCatch:w}=z(),{onError:g}=Z(),u=j(!1),p=j({response:{},payload:{}});W(async()=>{await x()}),G(()=>o.delivery,async()=>{await x()});const T=S(()=>{if(p.value.response)return _(p.value.response)}),L=S(()=>{if(p.value.payload)return _(p.value.payload)}),_=e=>{const r=typeof e=="string"?Y(e,{ocd:!0}):K(JSON.stringify(e),{indent_size:"",space_in_empty_paren:!0});return I.highlight(r,{language:"json"}).value},$=e=>{switch(e){case"show":return y?route(`${d}.webhooks.deliveries.show`,{workspace:y.id,webhook:o.webhookId,delivery:o.delivery.id}):route(`${d}.system.webhooks.deliveries.show`,{webhook:o.webhookId,delivery:o.delivery.id});case"resend":return y?route(`${d}.webhooks.deliveries.resend`,{workspace:y.id,webhook:o.webhookId,delivery:o.delivery.id}):route(`${d}.system.webhooks.deliveries.resend`,{webhook:o.webhookId,delivery:o.delivery.id});default:return""}},x=()=>new Promise((e,r)=>{O.start(),u.value=!0,axios.get($("show")).then(c=>{p.value={response:c.data.response,payload:c.data.payload},e(c)}).catch(c=>{w(c),r(c)}).finally(()=>{O.done(),u.value=!1})}),B=()=>{Q.post($("resend"),{},{preserveState:!0,preserveScroll:!0,only:["deliveries"],onError:g})};return(e,r)=>{const c=H("tooltip");return i(),k(U,null,[s("div",te,[a(f,null,{default:n(()=>[a(f,{class:"w-full items-center"},{default:n(()=>[a(b,null,{default:n(()=>[m(l(e.$t(`webhook.event.${t.delivery.event}`)),1)]),_:1}),t.delivery.resent_manually?N((i(),k("div",se,[a(E,{class:"text-gray-500 !w-5 !h-5"})])),[[c,e.$t("webhook.resend_manually")]]):v("",!0)]),_:1}),a(A,{onClick:B,size:"sm"},{icon:n(()=>[a(E)]),default:n(()=>[m(" "+l(e.$t("webhook.resend")),1)]),_:1})]),_:1}),t.delivery.resend_at?(i(),h(f,{key:0,class:"mt-sm text-gray-500",gap:"gap-lg"},{default:n(()=>[s("div",null,l(e.$t("webhook.next_retry")),1),s("div",null,l(t.delivery.resend_at),1)]),_:1})):v("",!0)]),a(D,{lighter:!0}),s("div",oe,[a(b,null,{default:n(()=>[m(l(e.$t("webhook.response")),1)]),_:1}),a(f,{class:"mt-lg gap-xl"},{default:n(()=>[s("div",re,l(e.$t("webhook.http_status")),1),s("div",null,l(t.delivery.http_status),1)]),_:1}),s("div",ae,[u.value?(i(),h(C,{key:0})):v("",!0),u.value?v("",!0):(i(),k("pre",ie,[r[0]||(r[0]=m("                    ")),s("code",{innerHTML:T.value,class:"hljs json text-sm !p-0"},null,8,ne),r[1]||(r[1]=m(`
               `))]))])]),a(D),s("div",le,[a(b,null,{default:n(()=>[m(l(e.$t("webhook.payload")),1)]),_:1}),s("div",de,[u.value?(i(),h(C,{key:0})):v("",!0),u.value?v("",!0):(i(),k("pre",ue,[r[2]||(r[2]=m("                   ")),s("code",{innerHTML:L.value,class:"hljs json text-sm !p-0"},null,8,ce),r[3]||(r[3]=m(`
               `))]))])])],64)}}};export{Re as _,je as a};
